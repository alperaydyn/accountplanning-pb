{
  "metadata": {
    "application_name": "Account Planning System",
    "version": "2.0",
    "domain": "Corporate Banking - Portfolio Management",
    "target_users": ["Portfolio Managers", "Relationship Managers", "Administrators"],
    "technology_stack": "React 18 + TypeScript + Vite + Supabase + TailwindCSS",
    "last_updated": "2026-01-27"
  },

  "chunks": [
    {
      "id": "app_overview",
      "category": "General",
      "audience": ["business", "technical"],
      "title": "Application Overview",
      "business_description": "The Account Planning System is a corporate banking relationship management application designed for portfolio managers to optimize customer relationships and maximize revenue opportunities. It provides data-driven insights, AI-powered action recommendations, and streamlined customer engagement workflows.",
      "technical_description": "A React single-page application built with Vite, using Supabase for backend (PostgreSQL + Edge Functions), TanStack Query for state management, and React Router for navigation. Supports multi-language (TR/EN/ES) via LanguageContext.",
      "key_capabilities": [
        "Portfolio Management - Track and manage corporate banking customer portfolios",
        "AI-Powered Insights - Automated recommendations for customer actions and daily planning",
        "Primary Bank Analytics - Share of wallet analysis and competitive intelligence",
        "Product Performance Tracking - Stock/flow metrics with target achievement monitoring",
        "Customer Journey Visualization - Progressive relationship development roadmap",
        "Multi-language Support - Turkish, English, and Spanish interfaces"
      ],
      "related_files": ["src/App.tsx", "src/main.tsx", "README.md"]
    },

    {
      "id": "page_dashboard",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Dashboard Page",
      "route": "/",
      "business_description": "The main landing page providing a portfolio overview with personalized greeting, key summary metrics, daily action planning calendar, and AI-generated insights for portfolio optimization.",
      "technical_description": "Located at src/pages/Dashboard.tsx. Uses usePortfolioManager hook for user data, renders SummaryCards, DailyPlanPanel, and InsightsPanel components. Date selector syncs all components to view historical data.",
      "components": ["SummaryCards", "DailyPlanPanel", "InsightsPanel", "PageBreadcrumb"],
      "data_sources": ["portfolio_managers", "customers", "actions", "portfolio_targets", "ai_insights", "ai_action_insights", "customer_experience_metrics"],
      "hooks_used": ["usePortfolioManager", "useLanguage"],
      "features": [
        "Personalized time-based greeting (Good morning/afternoon/evening) with user's first name from portfolio_managers",
        "Decorative gradient header with glassmorphism effects and staggered entrance animations",
        "Historical date selector: current month, last 3 months, last 4 completed quarter ends, last 2 year ends",
        "5-column summary cards grid (Benchmark Score, Customer Journey, Primary Bank Score, Customer Experience, Actions)",
        "Each summary card is clickable and navigates to detailed page",
        "Daily plan panel with 3-column layout: pending actions list, day's actions with date selector, mini calendar",
        "Mini calendar with blue intensity gradient for completed actions (darker = more completed)",
        "Amber background for days with only pending actions",
        "Circular badge indicators showing planned action counts per day",
        "Hover tooltips on calendar days showing completed/total ratio",
        "Calendar legend explaining color meanings (Completed, Pending, Planned)",
        "AI Product Performance insights panel with critical/warning/info categorization",
        "AI Action Quality insights panel with sufficiency/alignment/balance/quality categories",
        "Insight version history dropdown to view and switch between historical versions",
        "Feedback system (like/dislike buttons) for AI-generated insights",
        "Refresh button to regenerate AI insights with new version"
      ],
      "related_files": ["src/pages/Dashboard.tsx", "src/components/dashboard/SummaryCards.tsx", "src/components/dashboard/DailyPlanPanel.tsx", "src/components/dashboard/InsightsPanel.tsx"]
    },

    {
      "id": "component_summary_cards",
      "category": "Components",
      "audience": ["business", "technical"],
      "title": "Summary Cards Component",
      "business_description": "Displays five key portfolio metrics in a responsive 5-column grid: Benchmark Score (HGO achievement), Customer Journey (customer distribution by status), Primary Bank Score (percentage of primary bank customers), Customer Experience Score, and Actions (planned/completed counts).",
      "technical_description": "Located at src/components/dashboard/SummaryCards.tsx. Calculates metrics from multiple data sources. Each card has gradient accents, hover effects (shadow elevation, scale up, arrow indicator), and is clickable to navigate to the relevant detailed page.",
      "metrics_displayed": [
        {
          "name": "Benchmark Score",
          "calculation": "Count of HGO% >= 75% across all portfolio targets (stock_count, stock_volume, flow_count, flow_volume) divided by total HGO count",
          "formula": "benchmarkScore = (count where HGO >= 75%) / (total HGO metrics)",
          "display_format": "X/Y (e.g., 12/16) with percentage subtitle",
          "data_source": "portfolio_targets table",
          "navigation": "/product-performance",
          "accent_color": "primary"
        },
        {
          "name": "Customer Journey",
          "calculation": "Total count of customers with status progression subtitle showing Aktif -> Target -> Strong Target -> Ana Banka counts",
          "display_format": "Total count with progression breakdown",
          "data_source": "customers table, status column",
          "navigation": "/customer-journey",
          "accent_color": "accent"
        },
        {
          "name": "Primary Bank Score",
          "calculation": "Percentage of customers with status 'Ana Banka' over total customers",
          "formula": "primaryBankScore = (count where status='Ana Banka') / (total customers) * 100",
          "display_format": "XX% with count fraction subtitle (e.g., 5/25)",
          "data_source": "customers table",
          "navigation": "/primary-bank",
          "accent_color": "success"
        },
        {
          "name": "Customer Experience",
          "calculation": "Overall experience score calculated from customer_experience_metrics with key moment analysis",
          "display_format": "XX% with X/6 key moments on track subtitle",
          "data_source": "customer_experience_metrics table",
          "navigation": "/customer-experience",
          "accent_color": "pink"
        },
        {
          "name": "Actions",
          "calculation": "Count of planned actions with completed count subtitle",
          "display_format": "Planned count with 'X completed' subtitle",
          "data_source": "actions table, current_status column",
          "navigation": "/agenda",
          "accent_color": "warning"
        }
      ],
      "visual_design": {
        "layout": "5-column grid on large screens, responsive on smaller",
        "card_accents": "Each card has unique gradient accent (primary, accent, success, pink, warning)",
        "hover_effects": "Shadow elevation, scale up (-translate-y-0.5), arrow indicator appears",
        "icon_backgrounds": "Rounded icon container with accent color background"
      },
      "hooks_used": ["usePortfolioSummary", "useCustomers", "useAllCustomerProducts", "useProductThresholds", "useProducts", "usePortfolioTargets", "useCustomerExperienceMetrics"],
      "related_files": ["src/components/dashboard/SummaryCards.tsx"]
    },

    {
      "id": "page_product_performance",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Product Performance Page",
      "route": "/product-performance",
      "business_description": "Shows portfolio-level product metrics and target achievement analysis with an interactive hero panel for filtering by status. Products are categorized by 3 base statuses (On Track, At Risk, Critical) which group 7 sub-statuses (Growing, Melting, Diversity, Ticket Size, etc.). Clicking a base status reveals checkbox sub-filters to precisely filter the product table.",
      "technical_description": "Located at src/pages/ProductPerformance.tsx. Uses usePortfolioTargets hook for metrics data. Implements hierarchical status filtering with activeBaseStatus and selectedDetailStatuses state. Hero panel uses 4-column grid layout with gradient glassmorphism styling. ProductPerformanceTable receives statusFilter prop as array for multi-status filtering.",
      "features": [
        "Date period selector: current month, last 3 months, last 4 quarter ends, last 2 year ends",
        "Hero panel with 4-column KPI grid (Total, On Track, At Risk, Critical)",
        "Clicking Total clears all filters and shows all products",
        "Clicking base status (On Track/At Risk/Critical) expands sub-status checkbox panel",
        "Sub-statuses auto-selected when base status clicked, can be individually toggled",
        "Active filter indicator badge with comma-separated status names and clear button",
        "Color-coded status cards: emerald (On Track), amber (At Risk), destructive (Critical)",
        "Each sub-status has unique icon (CheckCircle, Zap, Users, Target, TrendingUp, Receipt, AlertTriangle)",
        "Product table with dual rows per product (Stock row + Flow row)",
        "Row click navigates to /customers?product={productId}",
        "Create Records button generates sample data for selected period",
        "Regenerate Insights button when data exists"
      ],
      "status_grouping": {
        "on_track_group": {
          "label": "Yolunda (On Track)",
          "color": "emerald",
          "sub_statuses": ["on_track", "growing", "diversity"]
        },
        "at_risk_group": {
          "label": "Riskli (At Risk)", 
          "color": "amber",
          "sub_statuses": ["at_risk", "melting", "ticket_size"]
        },
        "critical_group": {
          "label": "Kritik (Critical)",
          "color": "destructive",
          "sub_statuses": ["critical"]
        }
      },
      "status_definitions": {
        "on_track": "Overall average HGO >= 80% - product performing well",
        "at_risk": "Overall average HGO >= 50% but < 80% - needs attention",
        "critical": "Overall average HGO < 50% - requires immediate action",
        "melting": "Stock metrics good (>= 80%) but flow metrics low (< 80%) - losing momentum, existing customers strong but not acquiring new",
        "growing": "Flow metrics good (>= 80%) but stock metrics low (< 80%) - building up, acquiring well but stock base still small",
        "ticket_size": "Customer count good but volume low - many customers with small transactions",
        "diversity": "Volume good but customer count low - few large customers, concentration risk"
      },
      "status_calculation": {
        "function": "getProductStatus()",
        "variables": {
          "stockAvg": "(stock_count_tar + stock_volume_tar) / 2",
          "flowAvg": "(flow_count_tar + flow_volume_tar) / 2",
          "countAvg": "(stock_count_tar + flow_count_tar) / 2",
          "volumeAvg": "(stock_volume_tar + flow_volume_tar) / 2",
          "overallAvg": "(stock_count_tar + stock_volume_tar + flow_count_tar + flow_volume_tar) / 4"
        },
        "logic": "Check specific conditions first (melting, growing, ticket_size, diversity), then fall back to overall average thresholds",
        "thresholds": { "GOOD_THRESHOLD": 80, "BAD_THRESHOLD": 50 }
      },
      "table_structure": {
        "row_per_product": 2,
        "row_types": ["Stock", "Flow"],
        "columns": ["Product Name", "Type", "Count", "HGO%", "YTD Delta", "MTD Delta", "Volume", "Volume HGO%", "Volume YTD", "Volume MTD", "Actions", "Status"],
        "product_name_rowspan": 2,
        "actions_rowspan": 2,
        "status_rowspan": 2
      },
      "data_source": "portfolio_targets table joined with products table, actions table for counts",
      "hooks_used": ["usePortfolioTargets", "useActions", "useLanguage", "useCreatePortfolioTargets"],
      "related_files": ["src/pages/ProductPerformance.tsx", "src/components/dashboard/ProductPerformanceTable.tsx", "src/hooks/usePortfolioTargets.ts"]
    },

    {
      "id": "page_customer_journey",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Customer Journey Page",
      "route": "/customer-journey",
      "business_description": "Visual customer progression roadmap showing how customers move through relationship stages from new customer to primary bank status. Features an interactive SVG road visualization with pin markers, stage description cards, development strategy cards with actionable tips, and summary statistics. Provides one-click navigation to filtered customer lists for each stage.",
      "technical_description": "Located at src/pages/CustomerJourney.tsx. Uses useCustomers hook to aggregate customer counts by status field. Implements SVG path for curved road with quadratic bezier curves. Pin markers use dynamic vertical positioning (topOffsets array) to follow the curve. Uses statusColors object for consistent theming. Deep-links to /customers?status={key} which is read by Customers page useEffect.",
      "features": [
        "SVG curved road visualization with gradient background and dashed center line",
        "Five color-coded pin markers positioned at varying heights along the curve",
        "Pin markers with rounded icon container, status icon (Users/TrendingUp/Target/Star/Building2), and pin tail triangle",
        "Hover effect on pins: scale-110 transform with shadow elevation",
        "Customer count displayed below each marker with loading state support",
        "Stage legend with color dots, status labels, and arrow separators between stages",
        "5-column stage description cards with left border accent matching stage color",
        "Development strategy cards showing 'From → To' progression (4 cards, excludes Ana Banka)",
        "Actionable tips checklist with CheckCircle2 icons for each progression step",
        "View Customers button with Sparkles icon deep-links to /customers?status={status_key}",
        "Summary statistics section with percentage breakdown per stage and customer counts",
        "Full TR/EN localization for all labels, descriptions, and tips"
      ],
      "journey_stages": [
        { 
          "key": "Yeni Müşteri", 
          "english": "New Customer", 
          "icon": "Users",
          "color": "emerald-500",
          "description_tr": "Yeni kazanılmış ve aktif olan müşteriler",
          "description_en": "Newly acquired and active customers",
          "tips_tr": ["İlk görüşmeyi planla", "İhtiyaç analizi yap", "Temel ürünleri tanıt"],
          "tips_en": ["Schedule first meeting", "Conduct needs analysis", "Introduce basic products"]
        },
        { 
          "key": "Aktif", 
          "english": "Active", 
          "icon": "TrendingUp",
          "color": "sky-500",
          "description_tr": "Aktiflik kriterlerinden en az birini sağlamış müşteriler",
          "description_en": "Customers meeting at least one activity criteria",
          "tips_tr": ["Ürün kullanımını artır", "Çapraz satış fırsatları", "Düzenli ziyaret planla"],
          "tips_en": ["Increase product usage", "Cross-sell opportunities", "Plan regular visits"]
        },
        { 
          "key": "Target", 
          "english": "Target", 
          "icon": "Target",
          "color": "blue-500",
          "description_tr": "İlgili segmentin hedef müşteri tanımına göre etkin olan müşteriler",
          "description_en": "Customers active based on segment target definitions",
          "tips_tr": ["Cüzdan payını analiz et", "Rekabet analizi yap", "Özelleştirilmiş teklifler sun"],
          "tips_en": ["Analyze wallet share", "Conduct competitor analysis", "Offer customized deals"]
        },
        { 
          "key": "Strong Target", 
          "english": "Strong Target", 
          "icon": "Star",
          "color": "indigo-500",
          "description_tr": "İlgili segmentin güçlü müşteri tanımına göre etkin olan müşteriler",
          "description_en": "Customers active based on strong customer definitions",
          "tips_tr": ["Premium ürünler sun", "İlişkiyi derinleştir", "Stratejik ortaklık kur"],
          "tips_en": ["Offer premium products", "Deepen relationship", "Build strategic partnership"]
        },
        { 
          "key": "Ana Banka", 
          "english": "Primary Bank", 
          "icon": "Building2",
          "color": "primary",
          "description_tr": "En yoğun çalışma yapılan ana banka olmak",
          "description_en": "Being the primary bank with the highest engagement",
          "tips_tr": ["İlişkiyi koru", "Yeni ihtiyaçları takip et", "Sadakat programları uygula"],
          "tips_en": ["Maintain relationship", "Track new needs", "Implement loyalty programs"]
        }
      ],
      "visual_design": {
        "road_svg": {
          "viewBox": "0 0 1200 200",
          "road_stroke_width": 60,
          "center_line_dash": "10 10",
          "path": "M 0 150 Q 150 150 250 120 Q 400 70 550 90 Q 700 110 850 60 Q 1000 10 1200 30"
        },
        "pin_positions": ["top-[60%]", "top-[45%]", "top-[35%]", "top-[20%]", "top-[10%]"],
        "pin_size": "w-12 h-12 md:w-16 md:h-16",
        "status_colors": {
          "Yeni Müşteri": { "bg": "emerald-500", "text": "emerald-500", "light": "emerald-500/10" },
          "Aktif": { "bg": "sky-500", "text": "sky-500", "light": "sky-500/10" },
          "Target": { "bg": "blue-500", "text": "blue-500", "light": "blue-500/10" },
          "Strong Target": { "bg": "indigo-500", "text": "indigo-500", "light": "indigo-500/10" },
          "Ana Banka": { "bg": "primary", "text": "primary", "light": "primary/10" }
        }
      },
      "navigation": {
        "view_customers_button": "Navigates to /customers?status={stage.key}",
        "url_encoding": "encodeURIComponent(stage.key)",
        "customers_page_sync": "Customers page reads status URL param in useEffect to pre-filter list"
      },
      "data_source": "customers table, aggregated by status column",
      "hooks_used": ["useCustomers", "useLanguage", "useNavigate"],
      "related_files": ["src/pages/CustomerJourney.tsx"]
    },

    {
      "id": "page_primary_bank",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Primary Bank Page",
      "route": "/primary-bank",
      "business_description": "Share of wallet analysis and competitive positioning dashboard. Shows overall principality score aggregated across filtered customers, with breakdowns into external market data (Loans, POS, Cheque, Collateral) and internal product metrics (Products, Transactional, Liabilities, Assets). Provides segment and sector filtering with visual progress bars and navigation to the data generation engine.",
      "technical_description": "Located at src/pages/PrimaryBank.tsx. Uses usePrimaryBankData hook for share calculations and useCustomers with segment/sector filters. Implements getProgressColor function for color-coded progress bars. Internal axes derived from overall score with ±15% variance. All labels fully localized via useLanguage hook.",
      "features": [
        "Back button (ArrowLeft) to return to previous page",
        "Engine navigation button with Cog icon navigates to /primary-bank/engine",
        "Segment dropdown filter (MİKRO, Kİ, OBİ, TİCARİ) with Users icon",
        "Sector dropdown filter (Turizm, Ulaşım, Perakende, etc.) with Factory icon",
        "'Tümü' (All) option in filters to show all customers",
        "Main score card with 5xl percentage display and filter labels in subtitle",
        "External data section (Banka Dışı Veriler) with 4-column grid",
        "Loans card (Banknote icon), POS card (Receipt icon), Cheque card (FileCheck icon), Collateral card (Shield icon)",
        "Internal data section (Banka İçi Veriler) with 4-column grid",
        "Products Axis (Package icon), Transactional Axis (CreditCard icon), Liabilities Axis (PiggyBank icon), Assets Axis (Wallet icon)",
        "Progress bar color coding: success (>=80%), warning (>=60%), destructive (<60%)",
        "Loading state displays '...' while data fetching",
        "Bottom explanation card with contextual description"
      ],
      "principality_score": {
        "definition": "Weighted average of share of wallet across different banking product categories",
        "formula": "overallScore = loanShare * 0.4 + posShare * 0.3 + chequeShare * 0.2 + collateralShare * 0.1",
        "weights": { "loanShare": 0.4, "posShare": 0.3, "chequeShare": 0.2, "collateralShare": 0.1 },
        "dynamic_weighting": "If customer lacks data for a category, that weight is excluded from denominator"
      },
      "share_calculations": {
        "loan_share": {
          "formula": "(our_bank cash + non_cash) / (all banks cash + non_cash) * 100",
          "data_source": "primary_bank_loan_summary table",
          "our_bank_flag": "our_bank_flag = true"
        },
        "pos_share": {
          "formula": "Average of pos_share across customers with total_pos_volume > 0",
          "data_source": "primary_bank_pos table"
        },
        "cheque_share": {
          "formula": "(customers with cheque_volume_12m > 0) / (total customers) * 100",
          "data_source": "primary_bank_cheque table"
        },
        "collateral_share": {
          "formula": "(our_bank group1-4 amounts) / (all banks group1-4 amounts) * 100",
          "data_source": "primary_bank_collateral table",
          "our_bank_flag": "our_bank_flag = true"
        }
      },
      "external_data_metrics": [
        { "name": "Krediler (Loans)", "icon": "Banknote", "description": "Bank's share of customer total loans (cash + non-cash)" },
        { "name": "POS", "icon": "Receipt", "description": "Point-of-sale transaction volume share" },
        { "name": "Çek (Cheque)", "icon": "FileCheck", "description": "Percentage of customers with cheque activity at our bank" },
        { "name": "Teminat (Collateral)", "icon": "Shield", "description": "Collateral registration share" }
      ],
      "internal_axes": [
        { "name": "Ürün Ekseni (Products Axis)", "icon": "Package", "description": "Product diversity score", "calculation": "baseScore ± 15% variance" },
        { "name": "İşlem Ekseni (Transactional Axis)", "icon": "CreditCard", "description": "Transaction activity score", "calculation": "baseScore ± 15% variance" },
        { "name": "Pasif Ekseni (Liabilities Axis)", "icon": "PiggyBank", "description": "Deposit and liability score", "calculation": "baseScore ± 15% variance" },
        { "name": "Aktif Ekseni (Assets Axis)", "icon": "Wallet", "description": "Lending and asset score", "calculation": "baseScore ± 15% variance" }
      ],
      "progress_bar_colors": {
        "success": ">= 80%",
        "warning": ">= 60% and < 80%",
        "destructive": "< 60%"
      },
      "filters": {
        "segment": { "options": ["all", "MİKRO", "Kİ", "OBİ", "TİCARİ"], "icon": "Users" },
        "sector": { "options": ["all", "Turizm", "Ulaşım", "Perakende", "Gayrimenkul", "Tarım Hayvancılık", "Sağlık", "Enerji"], "icon": "Factory" }
      },
      "navigation": {
        "back_button": "navigate(-1)",
        "engine_button": "navigate('/primary-bank/engine')"
      },
      "hooks_used": ["usePrimaryBankData", "useCustomers", "useLanguage", "useNavigate"],
      "related_files": ["src/pages/PrimaryBank.tsx", "src/hooks/usePrimaryBankData.ts"]
    },

    {
      "id": "page_primary_bank_engine",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Primary Bank Engine Page",
      "route": "/primary-bank/engine",
      "business_description": "AI-powered batch processing engine to generate primary bank data for the entire customer portfolio. Allows generating competitive intelligence data with progress tracking, pause/resume capability, and individual customer data management.",
      "technical_description": "Located at src/pages/PrimaryBankEngine.tsx. Calls generate-primary-bank-data edge function. Supports batch processing with state persistence across page refreshes. Shows status indicators (Pending, Processing, Success, Error, Existing) for each customer.",
      "features": [
        "Batch data generation for entire portfolio",
        "Progress tracking with pause/resume",
        "State persistence across page refreshes",
        "Overwrite existing data option",
        "Manual generation for individual customers",
        "Record month selection for historical data",
        "Data type badges (Summary, Detail, POS, Cheque, Collateral)",
        "Delete and regenerate options",
        "AI provider display"
      ],
      "edge_function": "generate-primary-bank-data",
      "related_files": ["src/pages/PrimaryBankEngine.tsx", "supabase/functions/generate-primary-bank-data/index.ts"]
    },

    {
      "id": "page_customers",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Customers Page",
      "route": "/customers",
      "business_description": "Customer portfolio management with advanced search, multi-filter capabilities, AI-powered customer generation, and seamless navigation to individual customer details. Features action-level search with deep-linking to auto-open action modals on customer detail page.",
      "technical_description": "Located at src/pages/Customers.tsx. Uses custom useDebounce hook (300ms) for smooth search filtering. Implements client-side filtering with keepPreviousData pattern to prevent flickering. URL parameters sync via useSearchParams hook. Product counts fetched via separate query for performance. Action matching creates clickable links with ?action={id} deep-linking.",
      "features": [
        "AI-powered customer generation button (Sparkles icon) opens CreateCustomerModal",
        "300ms debounced search across customer names, action names, and group names",
        "Client-side filtering with keepPreviousData for flicker-free UX",
        "Status filter dropdown (Yeni Müşteri, Aktif, Target, Strong Target, Ana Banka)",
        "Product filter dropdown with all products from useProducts hook",
        "Group filter dropdown with customer groups from useCustomerGroups hook",
        "Action status filter (Beklemede, Planlandı, first 3 statuses)",
        "URL parameter sync: ?status=, ?product=, ?group= for deep-linking",
        "Matching action links displayed below customer name when search matches action names",
        "Action links navigate to /customers/{id}?action={actionId} for auto-opening modal",
        "Shows up to 3 matching actions with '+N more' for overflow",
        "Group badge is clickable to filter by that group",
        "Product count badge with Package icon",
        "Action counts displayed as planned (green) / pending (amber)",
        "Color-coded status badges (emerald, amber, sky, slate)",
        "Empty state with Users icon and localized message",
        "Row click navigates to /customers/{id}"
      ],
      "filters": {
        "search": {
          "type": "debounced_input",
          "delay_ms": 300,
          "targets": ["customer.name", "action.name", "customer_groups.name"],
          "implementation": "custom useDebounce hook, client-side filtering"
        },
        "status": {
          "options": ["all", "Yeni Müşteri", "Aktif", "Target", "Strong Target", "Ana Banka"],
          "url_param": "status"
        },
        "product": {
          "options": "dynamic from useProducts hook",
          "url_param": "product"
        },
        "group": {
          "options": "dynamic from useCustomerGroups hook",
          "url_param": "group"
        },
        "action_status": {
          "options": ["all", "Beklemede", "Planlandı"],
          "implementation": "filters customerIdsWithActionStatus set"
        }
      },
      "table_columns": {
        "customer_name": { "display": "Customer Name + matching action links", "sortable": false },
        "group": { "display": "Badge with Users icon, clickable to filter", "sortable": false },
        "sector": { "display": "Localized sector label", "sortable": false },
        "segment": { "display": "Localized segment label", "sortable": false },
        "status": { "display": "Color-coded badge", "sortable": false },
        "products": { "display": "Badge with Package icon + count", "sortable": false },
        "actions": { "display": "planned (green) / pending (amber)", "sortable": false },
        "last_activity": { "display": "Date or '-'", "sortable": false }
      },
      "status_badge_colors": {
        "Ana Banka": { "bg": "emerald-600", "text": "white" },
        "Strong Target": { "bg": "amber-500", "text": "white" },
        "Target": { "bg": "sky-500", "text": "white" },
        "Aktif": { "bg": "slate-400", "text": "white" },
        "Yeni Müşteri": { "bg": "slate-200", "text": "slate-600" }
      },
      "action_deep_linking": {
        "url_format": "/customers/{customerId}?action={actionId}",
        "behavior": "Customer Detail page reads ?action param and auto-opens ActionPlanningModal"
      },
      "data_sources": ["customers", "customer_groups", "products", "actions", "customer_products"],
      "hooks_used": ["useCustomers", "useCustomerGroups", "useProducts", "useActions", "useLanguage", "useDebounce (custom)"],
      "url_parameters": ["status", "product", "group"],
      "related_files": ["src/pages/Customers.tsx", "src/components/customer/CreateCustomerModal.tsx"]
    },

    {
      "id": "page_customer_detail",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Customer Detail Page",
      "route": "/customers/:customerId",
      "business_description": "Comprehensive single-customer view with four view modes: Primary Bank (share of wallet), Products (owned/not-owned with threshold comparison), Actions (sortable table with AI generation), and Autopilot (workflow automation). Features AI customer summary, deep-linking to specific actions, and multiple interactive modals.",
      "technical_description": "Located at src/pages/CustomerDetail.tsx. Uses useCustomerById, useCustomerProducts, useActionsByCustomer, useProducts, useProductThresholds hooks. Implements deep-linking via ?action= URL param that auto-opens ActionPlanningModal. Products view shows both owned (from customer_products) and not-owned products with thresholds from product_thresholds. Generate Actions calls generate-actions edge function.",
      "features": [
        "Customer header with name, status badge (color-coded), sector/segment subtitle",
        "Clickable header area opens PrincipalityScoreModal",
        "AI Customer Summary (collapsed by default, expands to show insights)",
        "4 view mode tabs: Primary Bank (Building2 icon), Products, Actions, Autopilot (Bot icon)",
        "Products view: 3-column grid of product cards with owned/not-owned styling",
        "Owned products show current value, threshold, gap (green TrendingUp or red AlertCircle)",
        "Not-owned products show threshold from sector/segment lookup, 'Not owned' italic label, muted bg",
        "Product card action badge: 'X/Y planned' (green) or 'X actions' (info)",
        "Product card click: if has actions → opens ActionPlanningModal, else → opens AddActionModal",
        "Products sorted by display_order from products table",
        "Actions view: priority and status filter dropdowns",
        "Generate Actions button (Sparkles, violet) calls AI edge function",
        "Add New Action button (Plus, emerald) opens AddActionModal",
        "Sortable actions table with 7 columns (Product, Name, Type, Priority, Status, Gap, Planned Date)",
        "Sort direction toggle (ArrowUp/ArrowDown icons)",
        "Action row click opens ActionPlanningModal",
        "Deep-link support: ?action={actionId} switches to Actions view and opens modal",
        "Empty state for no actions"
      ],
      "view_modes": {
        "primaryBank": {
          "icon": "Building2",
          "label": "Primary Bank",
          "description": "Customer-specific share of wallet analysis",
          "component": "PrimaryBankPanel"
        },
        "products": {
          "label": "Products",
          "description": "Product cards with current value, threshold, gap analysis. Shows both owned and not-owned products.",
          "layout": "3-column responsive grid",
          "card_click_behavior": "If actions exist: open ActionPlanningModal. If no actions: open AddActionModal with product pre-selected"
        },
        "actions": {
          "label": "Actions",
          "description": "Sortable/filterable action table with AI generation capability",
          "filters": ["priority (all/high/medium/low)", "status (all + ACTION_STATUSES)"],
          "buttons": ["Generate Actions (AI)", "Add New Action"],
          "table_columns": ["Product", "Action Name", "Type", "Priority", "Status", "Gap", "Planned Date"],
          "sortable_columns": ["product", "name", "type", "priority", "status", "gap", "plannedDate"]
        },
        "autopilot": {
          "icon": "Bot",
          "label": "Autopilot",
          "description": "Pre-configured workflow templates with step tracking",
          "component": "AutoPilotPanel"
        }
      },
      "generate_actions": {
        "edge_function": "generate-actions",
        "input": {
          "customer": "name, segment, sector, status, principality_score",
          "products": "all products with id, name, category",
          "ownedProductIds": "array of owned product IDs"
        },
        "output": "Array of actions with product_id, name, description, creation_reason, customer_hints, target_value, priority",
        "action_defaults": {
          "type": "model_based",
          "creator_name": "AI Action Generator",
          "source_data_date": "today",
          "action_target_date": "end of current month"
        }
      },
      "action_deep_linking": {
        "url_format": "/customers/{customerId}?action={actionId}",
        "behavior": "useEffect reads actionParam, waits for actions to load, switches to actions view, opens ActionPlanningModal",
        "deduplication": "handledActionParam state prevents re-handling same param"
      },
      "badge_colors": {
        "priority": {
          "high": "destructive",
          "medium": "default",
          "low": "secondary"
        },
        "status": {
          "Tamamlandı": "default",
          "Planlandı": "outline",
          "Beklemede": "secondary"
        },
        "customer_status": {
          "Ana Banka": "bg-emerald-600 text-white",
          "Strong Target": "bg-amber-500 text-white",
          "Target": "bg-sky-500 text-white",
          "Aktif": "bg-slate-400 text-white",
          "Yeni Müşteri": "bg-slate-200 text-slate-600"
        }
      },
      "modals": {
        "ActionPlanningModal": "Multi-action planning/editing with navigation between actions",
        "AddActionModal": "Create new action with optional product pre-selection",
        "PrincipalityScoreModal": "Detailed principality score breakdown with 4 axes"
      },
      "data_sources": ["customers", "customer_products", "products", "product_thresholds", "actions"],
      "hooks_used": ["useCustomerById", "useCustomerProducts", "useActionsByCustomer", "useProducts", "useProductThresholds", "useCreateAction", "useActionTemplates", "useLanguage"],
      "related_files": ["src/pages/CustomerDetail.tsx", "src/components/customer/PrimaryBankPanel.tsx", "src/components/customer/AICustomerSummary.tsx", "src/components/customer/AutoPilotPanel.tsx", "src/components/customer/PrincipalityScoreModal.tsx", "src/components/actions/ActionPlanningModal.tsx", "src/components/actions/AddActionModal.tsx"]
    },

    {
      "id": "page_actions_agenda",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Actions Agenda Page",
      "route": "/agenda",
      "business_description": "Calendar-based action planning and management with four view modes (Daily, Weekly, Monthly, List). Features multi-select status filtering, AI-powered day planning, and seamless deep-linking to action details. View preferences are persisted across sessions.",
      "technical_description": "Located at src/pages/ActionsAgenda.tsx. Uses useActions, useCustomers, useProducts hooks for data. View preference saved to user_settings.preferred_agenda_view via updateSettings. Implements Monday-based week grid. Status filter uses checkbox multi-select with at-least-one validation. List view includes debounced search, priority/status dropdowns, and paginated table.",
      "features": [
        "4 view mode tabs (Daily, Weekly, Monthly, List) with persistence to user_settings",
        "Multi-select status filter row with 6 statuses and action count badges",
        "Default selection: Beklemede + Planlandı (at least one must remain selected)",
        "Date navigation: Previous/Next by day/week/month, Today button",
        "Header text adapts to view mode (full date, week range, or month/year)",
        "Clicking day number in monthly/weekly view switches to daily view",
        "AI 'Planla' button on empty date cells navigates to /ai-assistant?prompt=plan-my-day&date=YYYY-MM-DD",
        "Global empty state with AI planning call-to-action",
        "Monthly view: 7-column Monday-based grid with weekend styling",
        "Weekly view: horizontal date sidebar with action chips",
        "Daily view: full action cards with priority borders",
        "List view: searchable, filterable, paginated 6-column table",
        "Priority-colored action badges (destructive/warning/muted)",
        "Status badges with icons (Clock, Calendar, CheckCircle, PauseCircle, XCircle)",
        "Action links deep-link to /customers/{id}?action={actionId}",
        "Customer name links to /customers/{id}"
      ],
      "view_modes": {
        "daily": {
          "description": "Single day view with full action cards",
          "navigation_step": "±1 day",
          "header_format": "EEEE, MMMM d, yyyy",
          "layout": "Stacked cards with priority-colored borders",
          "action_display": "Full card with action name, customer, product, status badge"
        },
        "weekly": {
          "description": "7-day horizontal list with compact action chips",
          "navigation_step": "±1 week",
          "header_format": "MMM d - MMM d, yyyy range",
          "layout": "Date sidebar + actions area per day",
          "action_display": "Inline chips: customer • action name + status badge",
          "week_start": "Monday (weekStartsOn: 1)"
        },
        "monthly": {
          "description": "Calendar grid with Monday-based week start",
          "navigation_step": "±1 month",
          "header_format": "MMMM yyyy",
          "layout": "7-column grid (Mon-Sun), day cells show up to 3 actions",
          "action_display": "Priority-colored links with +N more overflow",
          "weekend_styling": "Muted text and background colors"
        },
        "list": {
          "description": "Searchable, filterable, paginated table view",
          "navigation_step": "±1 month (filters current month's actions)",
          "header_format": "MMMM yyyy",
          "layout": "6-column table with filters header",
          "filters": ["Search (action/customer/product names)", "Priority dropdown", "Status dropdown"],
          "pagination": "10 items per page with Previous/Next",
          "columns": ["Action (+ description)", "Customer", "Product", "Priority", "Status", "Date"]
        }
      },
      "status_filter": {
        "type": "multi-select checkbox buttons",
        "statuses": [
          { "key": "Beklemede", "label": "Pending", "icon": "Clock", "color": "amber" },
          { "key": "Planlandı", "label": "Planned", "icon": "Calendar", "color": "primary" },
          { "key": "Tamamlandı", "label": "Completed", "icon": "CheckCircle2", "color": "emerald" },
          { "key": "Ertelendi", "label": "Postponed", "icon": "PauseCircle", "color": "slate" },
          { "key": "İlgilenmiyor", "label": "Not Interested", "icon": "XCircle", "color": "destructive" },
          { "key": "Uygun Değil", "label": "Not Suitable", "icon": "XCircle", "color": "destructive" }
        ],
        "default_selection": ["Beklemede", "Planlandı"],
        "validation": "At least one status must remain selected"
      },
      "priority_colors": {
        "high": { "bg": "bg-destructive/10", "text": "text-destructive", "border": "border-destructive/20" },
        "medium": { "bg": "bg-warning/10", "text": "text-warning", "border": "border-warning/20" },
        "low": { "bg": "bg-muted", "text": "text-muted-foreground", "border": "border-border" }
      },
      "action_date_logic": {
        "primary": "current_planned_date (if set)",
        "fallback": "action_target_date (for pending actions)",
        "display_format": "d MMM yyyy"
      },
      "ai_integration": {
        "trigger": "Empty date cells show 'Planla' button with Sparkles icon",
        "navigation": "/ai-assistant?prompt=plan-my-day&date=YYYY-MM-DD",
        "result": "AI suggestions saved as actions with target date from URL"
      },
      "deep_linking": {
        "action_link": "/customers/{customerId}?action={actionId}",
        "customer_link": "/customers/{customerId}",
        "url_param_filter": "?status=Planlandı or ?status=Beklemede pre-filters on load"
      },
      "weekend_handling": {
        "detection": "getDay(date) === 0 || getDay(date) === 6",
        "styling": "Muted text color (text-muted-foreground/70), muted background (bg-muted/30)"
      },
      "data_sources": ["actions", "customers", "products"],
      "hooks_used": ["useActions", "useCustomers", "useProducts", "useUserSettings", "useLanguage"],
      "url_parameters": ["status"],
      "related_files": ["src/pages/ActionsAgenda.tsx", "src/hooks/useActions.ts", "src/hooks/useUserSettings.ts"]
    },

    {
      "id": "page_ai_assistant",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "AI Assistant Page",
      "route": "/ai-assistant",
      "business_description": "Conversational AI interface for portfolio intelligence. Supports multiple chat sessions, 'Plan My Day' feature with automatic customer prioritization and action recommendations. Users can save suggested actions directly from AI responses.",
      "technical_description": "Located at src/pages/AIAssistant.tsx. Uses ai-action-assistant edge function. Chat history stored in ai_chat_sessions and ai_chat_messages tables. Supports URL trigger ?prompt=plan-my-day&date=YYYY-MM-DD.",
      "features": [
        "Multiple conversation threads",
        "Create/delete sessions",
        "Auto-title based on first message",
        "Plan My Day with date targeting",
        "Save actions from AI suggestions",
        "Token usage and cost tracking",
        "Privacy panel (collapsible)"
      ],
      "ai_context": [
        "Customer portfolio data",
        "Product holdings and thresholds",
        "Existing actions and status",
        "Action templates"
      ],
      "edge_function": "ai-action-assistant",
      "data_tables": ["ai_chat_sessions", "ai_chat_messages"],
      "hooks_used": ["useAIChatSessions", "useAIChatMessages", "useCustomers", "useActionTemplates"],
      "related_files": ["src/pages/AIAssistant.tsx", "supabase/functions/ai-action-assistant/index.ts", "src/components/ai/PlanMyDayDisplay.tsx"]
    },

    {
      "id": "page_thresholds",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Thresholds Page",
      "route": "/thresholds",
      "business_description": "Product threshold management interface. Shows threshold values per product/sector/segment combination with calculation date and version. Admin-only editing capability.",
      "technical_description": "Located at src/pages/Thresholds.tsx. Uses useProductThresholds hook. Admin role checked via useUserRole. Edit modal for threshold value updates.",
      "table_columns": ["Product", "Sector", "Segment", "Threshold Value", "Calculation Date", "Version", "Active Status"],
      "filters": ["Product", "Sector", "Segment", "Active/Inactive status"],
      "role_based_access": {
        "admin": "Full edit access",
        "user": "Read-only view"
      },
      "data_source": "product_thresholds table joined with products",
      "hooks_used": ["useProductThresholds", "useUserRole", "useLanguage"],
      "related_files": ["src/pages/Thresholds.tsx"]
    },

    {
      "id": "page_settings",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Settings Page",
      "route": "/settings",
      "business_description": "Technical configuration page for AI provider settings, voice settings (ElevenLabs), and SQL query runner. Typically used by power users and administrators.",
      "technical_description": "Located at src/pages/Settings.tsx. Contains AIProviderSettings, ElevenLabsSettings, and QueryPanel components.",
      "sections": [
        {
          "name": "AI Provider Settings",
          "description": "Configure AI provider (Lovable, OpenAI, OpenRouter, Local), model selection, API key, connection test",
          "component": "AIProviderSettings"
        },
        {
          "name": "ElevenLabs Voice Settings",
          "description": "Voice selection, parameters (stability, similarity, speed, style), speaker boost, voice history",
          "component": "ElevenLabsSettings"
        },
        {
          "name": "SQL Query Panel",
          "description": "Execute read-only SQL queries, save/load queries, results display",
          "component": "QueryPanel"
        }
      ],
      "data_source": "user_settings, saved_queries tables",
      "related_files": ["src/pages/Settings.tsx", "src/components/settings/AIProviderSettings.tsx", "src/components/settings/ElevenLabsSettings.tsx", "src/components/settings/QueryPanel.tsx"]
    },

    {
      "id": "page_preferences",
      "category": "Pages",
      "audience": ["business", "technical"],
      "title": "Preferences Page",
      "route": "/preferences",
      "business_description": "User personalization settings including language selection (Turkish, English, Spanish), preferred agenda view mode, and access to documentation.",
      "technical_description": "Located at src/pages/Preferences.tsx. Uses useUserSettings hook for language and agenda view preference.",
      "settings": [
        { "name": "Language", "options": ["Turkish (tr)", "English (en)", "Spanish (es)"] },
        { "name": "Preferred Agenda View", "options": ["Daily", "Weekly", "Monthly", "List"] },
        { "name": "Documentation Link", "description": "Access to README documentation" }
      ],
      "data_source": "user_settings table",
      "hooks_used": ["useUserSettings", "useLanguage"],
      "related_files": ["src/pages/Preferences.tsx"]
    },

    {
      "id": "db_customers",
      "category": "Database",
      "audience": ["technical"],
      "title": "Customers Table",
      "table_name": "customers",
      "description": "Core table storing corporate customer records with their relationship status, segment classification, and portfolio manager assignment.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "name", "type": "text", "description": "Customer company name" },
        { "name": "sector", "type": "customer_sector enum", "description": "Business sector", "values": ["Turizm", "Ulasim", "Perakende", "Gayrimenkul", "Tarim Hayvancilik", "Saglik", "Enerji"] },
        { "name": "segment", "type": "customer_segment enum", "description": "Customer size segment", "values": ["MIKRO", "KI", "OBI", "TICARI"] },
        { "name": "status", "type": "customer_status enum", "description": "Relationship status", "values": ["Yeni Musteri", "Aktif", "Target", "Strong Target", "Ana Banka"] },
        { "name": "principality_score", "type": "number", "description": "Primary bank score (0-100)" },
        { "name": "last_activity_date", "type": "date", "description": "Last interaction date" },
        { "name": "portfolio_manager_id", "type": "uuid", "description": "FK to portfolio_managers" },
        { "name": "group_id", "type": "uuid", "description": "FK to customer_groups (holding company)" },
        { "name": "created_at", "type": "timestamp", "description": "Record creation time" },
        { "name": "updated_at", "type": "timestamp", "description": "Last update time" }
      ],
      "relationships": [
        { "table": "portfolio_managers", "type": "many-to-one", "foreign_key": "portfolio_manager_id" },
        { "table": "customer_groups", "type": "many-to-one", "foreign_key": "group_id" }
      ],
      "rls_policy": "Users can only access customers where portfolio_manager_id matches their portfolio manager"
    },

    {
      "id": "db_actions",
      "category": "Database",
      "audience": ["technical"],
      "title": "Actions Table",
      "table_name": "actions",
      "description": "Stores sales and relationship actions for customers. Actions can be AI-generated (model_based), manually created (ad_hoc, rm_action), or recurring (recursive).",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "customer_id", "type": "uuid", "description": "FK to customers" },
        { "name": "product_id", "type": "uuid", "description": "FK to products" },
        { "name": "name", "type": "text", "description": "Action name/title" },
        { "name": "description", "type": "text", "description": "Detailed description" },
        { "name": "creator_name", "type": "text", "description": "Who created the action" },
        { "name": "creation_reason", "type": "text", "description": "Why the action was created" },
        { "name": "customer_hints", "type": "text", "description": "AI hints about customer context" },
        { "name": "source_data_date", "type": "date", "description": "Data date used for creation" },
        { "name": "action_target_date", "type": "date", "description": "Target completion date" },
        { "name": "type", "type": "action_type enum", "values": ["model_based", "ad_hoc", "rm_action", "recursive"], "description": "Action source type" },
        { "name": "priority", "type": "action_priority enum", "values": ["high", "medium", "low"], "description": "Priority level" },
        { "name": "target_value", "type": "number", "description": "Target transaction value" },
        { "name": "current_status", "type": "action_status enum", "values": ["Beklemede", "Planlandy", "Tamamlandy", "Ertelendi", "Ilgilenmiyor", "Uygun Degil"], "description": "Current action status" },
        { "name": "current_planned_date", "type": "date", "description": "Current planned date (may differ from target)" },
        { "name": "current_value", "type": "number", "description": "Current achieved value" },
        { "name": "is_recursive", "type": "boolean", "description": "Whether action repeats" },
        { "name": "recurrence_pattern", "type": "text", "description": "Recurrence pattern (daily, weekly, monthly)" },
        { "name": "recurrence_interval", "type": "number", "description": "Interval between recurrences" },
        { "name": "recurrence_end_date", "type": "date", "description": "When recurrence ends" },
        { "name": "next_recurrence_date", "type": "date", "description": "Next occurrence date" },
        { "name": "parent_action_id", "type": "uuid", "description": "FK to parent action for recurring" }
      ],
      "relationships": [
        { "table": "customers", "type": "many-to-one", "foreign_key": "customer_id" },
        { "table": "products", "type": "many-to-one", "foreign_key": "product_id" },
        { "table": "actions", "type": "self-reference", "foreign_key": "parent_action_id" }
      ],
      "status_flow": "Beklemede -> Planlandy -> Tamamlandy / Ertelendi / Ilgilenmiyor / Uygun Degil"
    },

    {
      "id": "db_products",
      "category": "Database",
      "audience": ["technical"],
      "title": "Products Table",
      "table_name": "products",
      "description": "Banking product catalog with categorization and display ordering.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "name", "type": "text", "description": "Product name" },
        { "name": "category", "type": "product_category enum", "values": ["Kredi", "Kaynak", "Odeme", "Tahsilat", "Sigorta", "Istirak"], "description": "Product category" },
        { "name": "description", "type": "text", "description": "Product description" },
        { "name": "display_order", "type": "number", "description": "UI display order" },
        { "name": "is_external", "type": "boolean", "description": "Whether product data comes from external sources" }
      ],
      "categories_explained": {
        "Kredi": "Loans (cash and non-cash)",
        "Kaynak": "Deposits and resources",
        "Odeme": "Payment services",
        "Tahsilat": "Collection services",
        "Sigorta": "Insurance products",
        "Istirak": "Investment/affiliate products"
      }
    },

    {
      "id": "db_customer_products",
      "category": "Database",
      "audience": ["technical"],
      "title": "Customer Products Table",
      "table_name": "customer_products",
      "description": "Junction table storing which products each customer has and their current values.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "customer_id", "type": "uuid", "description": "FK to customers" },
        { "name": "product_id", "type": "uuid", "description": "FK to products" },
        { "name": "current_value", "type": "number", "description": "Current product value/balance" },
        { "name": "external_data", "type": "number", "description": "External data value (from KKB/TCMB)" }
      ],
      "relationships": [
        { "table": "customers", "type": "many-to-one", "foreign_key": "customer_id" },
        { "table": "products", "type": "many-to-one", "foreign_key": "product_id" }
      ],
      "gap_calculation": "gap = threshold_value - current_value (calculated in useCustomerProducts hook)"
    },

    {
      "id": "db_product_thresholds",
      "category": "Database",
      "audience": ["technical"],
      "title": "Product Thresholds Table",
      "table_name": "product_thresholds",
      "description": "Target threshold values for products per sector/segment combination. Used to determine if a customer meets the 'primary bank' threshold for a product.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "product_id", "type": "uuid", "description": "FK to products" },
        { "name": "sector", "type": "customer_sector enum", "description": "Customer sector" },
        { "name": "segment", "type": "customer_segment enum", "description": "Customer segment" },
        { "name": "threshold_value", "type": "number", "description": "Target value threshold" },
        { "name": "calculation_date", "type": "date", "description": "When threshold was calculated" },
        { "name": "version_num", "type": "number", "description": "Version number" },
        { "name": "is_active", "type": "boolean", "description": "Whether this threshold is currently active" }
      ],
      "usage": "When displaying customer products, the threshold for that customer's sector/segment is looked up to calculate the gap"
    },

    {
      "id": "db_portfolio_targets",
      "category": "Database",
      "audience": ["technical"],
      "title": "Portfolio Targets Table",
      "table_name": "portfolio_targets",
      "description": "Portfolio-level target metrics for products. Contains stock and flow metrics with actual values, targets, and delta calculations.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "portfolio_manager_id", "type": "uuid", "description": "FK to portfolio_managers" },
        { "name": "product_id", "type": "uuid", "description": "FK to products" },
        { "name": "record_date", "type": "date", "description": "Period date (YYYY-MM format)" },
        { "name": "measure_date", "type": "date", "description": "When measurement was taken" },
        { "name": "stock_count", "type": "number", "description": "Current customer count (stock)" },
        { "name": "stock_count_target", "type": "number", "description": "Target customer count" },
        { "name": "stock_count_tar", "type": "number", "description": "HGO% (stock_count/target*100)" },
        { "name": "stock_count_delta_ytd", "type": "number", "description": "Year-to-date change" },
        { "name": "stock_count_delta_mtd", "type": "number", "description": "Month-to-date change" },
        { "name": "stock_volume", "type": "number", "description": "Current volume (stock)" },
        { "name": "stock_volume_target", "type": "number", "description": "Target volume" },
        { "name": "stock_volume_tar", "type": "number", "description": "HGO% for volume" },
        { "name": "stock_volume_delta_ytd", "type": "number", "description": "YTD volume change" },
        { "name": "stock_volume_delta_mtd", "type": "number", "description": "MTD volume change" },
        { "name": "flow_count", "type": "number", "description": "New acquisitions count (flow)" },
        { "name": "flow_count_target", "type": "number", "description": "Target acquisitions" },
        { "name": "flow_count_tar", "type": "number", "description": "HGO% for flow count" },
        { "name": "flow_volume", "type": "number", "description": "New volume (flow)" },
        { "name": "flow_volume_target", "type": "number", "description": "Target new volume" },
        { "name": "flow_volume_tar", "type": "number", "description": "HGO% for flow volume" }
      ],
      "metrics_explained": {
        "Stock": "Current state - total customers/volume at a point in time",
        "Flow": "Change - new acquisitions during the period",
        "TAR/HGO%": "Target Achievement Ratio = (actual / target) * 100",
        "YTD": "Year-to-date cumulative change",
        "MTD": "Month-to-date change"
      }
    },

    {
      "id": "db_primary_bank_loan_summary",
      "category": "Database",
      "audience": ["technical"],
      "title": "Primary Bank Loan Summary Table",
      "table_name": "primary_bank_loan_summary",
      "description": "Bank-level loan summary data per customer showing cash and non-cash loan amounts across all banks the customer works with.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "customer_id", "type": "uuid", "description": "FK to customers" },
        { "name": "bank_code", "type": "text", "description": "Bank identifier" },
        { "name": "cash_loan", "type": "number", "description": "Cash loan amount" },
        { "name": "non_cash_loan", "type": "number", "description": "Non-cash loan amount (guarantees, LCs)" },
        { "name": "our_bank_flag", "type": "boolean", "description": "True if this is our bank" },
        { "name": "last_approval_date", "type": "date", "description": "Last credit approval date" },
        { "name": "record_month", "type": "text", "description": "Record month (YYYY-MM)" }
      ],
      "loan_share_calculation": "loanShare = (sum of our_bank cash+non_cash) / (sum of all banks cash+non_cash) * 100"
    },

    {
      "id": "db_primary_bank_pos",
      "category": "Database",
      "audience": ["technical"],
      "title": "Primary Bank POS Table",
      "table_name": "primary_bank_pos",
      "description": "POS (Point of Sale) transaction volume data showing our bank's share of the customer's total POS volume.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "customer_id", "type": "uuid", "description": "FK to customers" },
        { "name": "total_pos_volume", "type": "number", "description": "Total POS volume across all banks" },
        { "name": "our_bank_pos_volume", "type": "number", "description": "Our bank's POS volume" },
        { "name": "pos_share", "type": "number", "description": "Our share percentage" },
        { "name": "number_of_banks", "type": "number", "description": "Number of banks customer uses for POS" },
        { "name": "record_month", "type": "text", "description": "Record month" }
      ]
    },

    {
      "id": "db_primary_bank_cheque",
      "category": "Database",
      "audience": ["technical"],
      "title": "Primary Bank Cheque Table",
      "table_name": "primary_bank_cheque",
      "description": "Cheque processing volume data for customers.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "customer_id", "type": "uuid", "description": "FK to customers" },
        { "name": "cheque_volume_1m", "type": "number", "description": "Cheque volume last 1 month" },
        { "name": "cheque_volume_3m", "type": "number", "description": "Cheque volume last 3 months" },
        { "name": "cheque_volume_12m", "type": "number", "description": "Cheque volume last 12 months" },
        { "name": "record_month", "type": "text", "description": "Record month" }
      ],
      "cheque_activity_check": "chequeActive = cheque_volume_12m > 0"
    },

    {
      "id": "db_primary_bank_collateral",
      "category": "Database",
      "audience": ["technical"],
      "title": "Primary Bank Collateral Table",
      "table_name": "primary_bank_collateral",
      "description": "Collateral registration data showing pledged assets across different banks.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "customer_id", "type": "uuid", "description": "FK to customers" },
        { "name": "bank_code", "type": "text", "description": "Bank identifier" },
        { "name": "group1_amount", "type": "number", "description": "Group 1 collateral amount" },
        { "name": "group2_amount", "type": "number", "description": "Group 2 collateral amount" },
        { "name": "group3_amount", "type": "number", "description": "Group 3 collateral amount" },
        { "name": "group4_amount", "type": "number", "description": "Group 4 collateral amount" },
        { "name": "our_bank_flag", "type": "boolean", "description": "True if this is our bank" },
        { "name": "record_month", "type": "text", "description": "Record month" }
      ],
      "collateral_share_calculation": "collateralShare = (sum of our_bank groups) / (sum of all banks groups) * 100"
    },

    {
      "id": "db_action_templates",
      "category": "Database",
      "audience": ["technical"],
      "title": "Action Templates Table",
      "table_name": "action_templates",
      "description": "Pre-defined action types per product. Used by AI to suggest appropriate actions and by users when creating new actions.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "product_id", "type": "uuid", "description": "FK to products" },
        { "name": "name", "type": "text", "description": "Template action name" },
        { "name": "description", "type": "text", "description": "Template description" },
        { "name": "display_order", "type": "number", "description": "UI display order" }
      ],
      "usage": "When AI suggests actions, it uses these templates to ensure actions are appropriate for each product"
    },

    {
      "id": "db_ai_chat_sessions",
      "category": "Database",
      "audience": ["technical"],
      "title": "AI Chat Sessions Table",
      "table_name": "ai_chat_sessions",
      "description": "Stores AI assistant conversation sessions for each portfolio manager.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "portfolio_manager_id", "type": "uuid", "description": "FK to portfolio_managers" },
        { "name": "title", "type": "text", "description": "Session title (auto-generated from first message)" },
        { "name": "provider", "type": "text", "description": "AI provider used" }
      ]
    },

    {
      "id": "db_ai_insights",
      "category": "Database",
      "audience": ["technical"],
      "title": "AI Insights Table",
      "table_name": "ai_insights",
      "description": "Stores AI-generated portfolio insights with versioning for historical comparison.",
      "columns": [
        { "name": "id", "type": "uuid", "description": "Primary key" },
        { "name": "portfolio_manager_id", "type": "uuid", "description": "FK to portfolio_managers" },
        { "name": "record_date", "type": "date", "description": "Period date" },
        { "name": "version", "type": "number", "description": "Version number (increments on regeneration)" },
        { "name": "model_name", "type": "text", "description": "AI model used" },
        { "name": "insights", "type": "json", "description": "Array of insight objects" },
        { "name": "feedback", "type": "text", "description": "User feedback (like/dislike)" },
        { "name": "provider", "type": "text", "description": "AI provider" }
      ],
      "insight_structure": {
        "type": "critical | warning | info",
        "title": "Short title",
        "message": "Summary (max 15 words)",
        "analysis": "Current situation analysis (2-3 sentences)",
        "recommendations": ["Action item 1", "Action item 2"],
        "products": [{ "name": "Product Name", "id": "uuid" }]
      }
    },

    {
      "id": "hook_usePortfolioSummary",
      "category": "Hooks",
      "audience": ["technical"],
      "title": "usePortfolioSummary Hook",
      "file": "src/hooks/usePortfolioSummary.ts",
      "description": "Fetches aggregated portfolio metrics for the current user's portfolio.",
      "returns": {
        "totalCustomers": "Total number of customers",
        "primaryBankCustomers": "Customers with status 'Ana Banka'",
        "nonPrimaryCustomers": "totalCustomers - primaryBankCustomers",
        "primaryBankScore": "Average principality_score across all customers",
        "totalActionsPlanned": "Count of actions with status 'Planlandy'",
        "totalActionsCompleted": "Count of actions with status 'Tamamlandy'",
        "totalActionsPending": "Count of actions with status 'Beklemede'"
      },
      "data_sources": ["customers", "actions"],
      "depends_on": ["usePortfolioManager"]
    },

    {
      "id": "hook_usePrimaryBankData",
      "category": "Hooks",
      "audience": ["technical"],
      "title": "usePrimaryBankData Hook",
      "file": "src/hooks/usePrimaryBankData.ts",
      "description": "Calculates share of wallet metrics for a set of customers.",
      "parameters": {
        "customerIds": "Array of customer UUIDs",
        "recordMonth": "Optional record month filter"
      },
      "returns": {
        "loanShare": "Our bank's share of total loans across all customers",
        "posShare": "Average POS share across customers with POS data",
        "chequeShare": "Percentage of customers with cheque activity",
        "collateralShare": "Our bank's share of total collateral",
        "overallScore": "Weighted average: loan*0.4 + pos*0.3 + cheque*0.2 + collateral*0.1"
      },
      "calculation_details": {
        "loanShare": "(sum of our_bank cash_loan + non_cash_loan) / (sum of all banks) * 100",
        "posShare": "average of pos_share field across customers with POS volume > 0",
        "chequeShare": "(customers with cheque_volume_12m > 0) / (total customers) * 100",
        "collateralShare": "(sum of our_bank groups 1-4) / (sum of all banks groups 1-4) * 100"
      },
      "data_sources": ["primary_bank_loan_summary", "primary_bank_pos", "primary_bank_cheque", "primary_bank_collateral"]
    },

    {
      "id": "hook_useCustomerProducts",
      "category": "Hooks",
      "audience": ["technical"],
      "title": "useCustomerProducts Hook",
      "file": "src/hooks/useCustomerProducts.ts",
      "description": "Fetches products for a specific customer with threshold comparison and gap calculation.",
      "parameters": {
        "customerId": "Customer UUID"
      },
      "returns": "Array of customer products with computed threshold and gap fields",
      "computation": {
        "threshold": "Looked up from product_thresholds for customer's sector/segment",
        "gap": "threshold - current_value (positive gap = opportunity)"
      },
      "data_sources": ["customer_products", "products", "product_thresholds", "customers"]
    },

    {
      "id": "hook_useInsights",
      "category": "Hooks",
      "audience": ["technical"],
      "title": "useInsights Hook",
      "file": "src/hooks/useInsights.ts",
      "description": "Fetches or generates AI portfolio insights. Calculates product status and triggers AI generation if no insights exist.",
      "status_calculation": {
        "function": "calculateStatus(stockCountTar, stockVolumeTar, flowCountTar, flowVolumeTar)",
        "logic": "Returns: melting, growing, ticket_size, diversity, critical, at_risk, or on_track based on threshold comparisons",
        "thresholds": { "GOOD_THRESHOLD": 80, "BAD_THRESHOLD": 50 }
      },
      "features": [
        "Auto-generates insights if none exist for the period",
        "Supports version selection for historical comparison",
        "Refresh/regenerate with new version number",
        "Feedback submission (like/dislike)"
      ],
      "edge_function": "generate-insights",
      "data_sources": ["portfolio_targets", "actions", "ai_insights"]
    },

    {
      "id": "edge_function_ai_action_assistant",
      "category": "Edge Functions",
      "audience": ["technical"],
      "title": "AI Action Assistant Edge Function",
      "file": "supabase/functions/ai-action-assistant/index.ts",
      "description": "Main AI chat handler that processes user messages and generates responses with portfolio context. Supports 'Plan My Day' feature.",
      "endpoint": "POST /functions/v1/ai-action-assistant",
      "request_body": {
        "message": "User's message",
        "customers": "Array of customer data with products and actions",
        "actionTemplates": "Available action templates",
        "chatHistory": "Previous messages in session"
      },
      "ai_providers": {
        "lovable": "Default - uses Lovable AI Gateway",
        "openai": "Direct OpenAI API",
        "openrouter": "OpenRouter API",
        "local": "Local OpenAI-compatible server"
      },
      "plan_my_day_feature": {
        "trigger": "Message contains 'plan my day' or 'gunumu planla'",
        "date_extraction": "Extracts target date from 'for YYYY-MM-DD' pattern",
        "customer_prioritization": "Ranks customers by: status progression potential, principality score, below-threshold products",
        "output": "Structured plan with customer names, products, and action recommendations"
      }
    },

    {
      "id": "edge_function_generate_insights",
      "category": "Edge Functions",
      "audience": ["technical"],
      "title": "Generate Insights Edge Function",
      "file": "supabase/functions/generate-insights/index.ts",
      "description": "Generates portfolio-level AI insights based on product performance data.",
      "endpoint": "POST /functions/v1/generate-insights",
      "request_body": {
        "products": "Array of product summaries with status, HGO%, pending actions"
      },
      "insight_types": {
        "critical": "Urgent action required (critical or melting products)",
        "warning": "Attention needed (at_risk, growing, ticket_size, diversity)",
        "info": "Opportunities (pending actions, growth potential)"
      },
      "response": {
        "insights": "Array of insight objects with type, title, message, analysis, recommendations, products"
      },
      "language": "Turkish (system prompt and output)"
    },

    {
      "id": "kpi_benchmark_score",
      "category": "KPIs",
      "audience": ["business", "technical"],
      "title": "Benchmark Score KPI",
      "business_description": "Measures portfolio performance by counting how many product metrics achieve at least 75% of their target (HGO >= 75%).",
      "formula": "benchmarkScore = (count of HGO% >= 75) / (total HGO metrics count)",
      "components": ["Stock Count HGO%", "Stock Volume HGO%", "Flow Count HGO%", "Flow Volume HGO%"],
      "calculation_location": "src/components/dashboard/SummaryCards.tsx",
      "data_source": "portfolio_targets table",
      "display_format": "X/Y (where X = metrics meeting threshold, Y = total metrics)",
      "good_threshold": ">=75%",
      "interpretation": "Higher ratio indicates better target achievement across the portfolio"
    },

    {
      "id": "kpi_primary_bank_score",
      "category": "KPIs",
      "audience": ["business", "technical"],
      "title": "Primary Bank Score KPI",
      "business_description": "Percentage of customers where our bank is the primary banking partner (status = 'Ana Banka').",
      "formula": "primaryBankScore = (customers with status 'Ana Banka') / (total customers) * 100",
      "calculation_location": "src/components/dashboard/SummaryCards.tsx",
      "data_source": "customers table, status column",
      "display_format": "X% (count shown as X/Y)",
      "interpretation": "Higher percentage indicates stronger customer relationships and deeper wallet share"
    },

    {
      "id": "kpi_principality_score",
      "category": "KPIs",
      "audience": ["business", "technical"],
      "title": "Principality Score (Share of Wallet)",
      "business_description": "Weighted measure of how much of a customer's banking business is with our bank. Combines external market data (loans, POS, cheques, collateral) into a single score.",
      "formula": "overallScore = loanShare*0.4 + posShare*0.3 + chequeShare*0.2 + collateralShare*0.1",
      "weights": {
        "loanShare": "40% - Most important factor",
        "posShare": "30% - Second most important",
        "chequeShare": "20% - Medium importance",
        "collateralShare": "10% - Supplementary factor"
      },
      "calculation_location": "src/hooks/usePrimaryBankData.ts, src/hooks/useCustomerPrimaryBankData.ts",
      "data_sources": ["primary_bank_loan_summary", "primary_bank_pos", "primary_bank_cheque", "primary_bank_collateral"],
      "display_format": "X% (0-100 scale)",
      "interpretation": "Higher score indicates we are the dominant banking partner for that customer"
    },

    {
      "id": "kpi_hgo_tar",
      "category": "KPIs",
      "audience": ["business", "technical"],
      "title": "HGO% (Target Achievement Ratio)",
      "business_description": "Hedef Gerceklesme Orani - Percentage of target achieved. Used for both stock and flow metrics at portfolio level.",
      "formula": "HGO% = (actual value / target value) * 100",
      "variants": ["stock_count_tar", "stock_volume_tar", "flow_count_tar", "flow_volume_tar"],
      "calculation_location": "Stored in portfolio_targets table, also calculated in usePortfolioTargets hook",
      "thresholds": {
        "good": ">=80% (On Track)",
        "medium": "50-80% (At Risk)",
        "bad": "<50% (Critical)"
      },
      "interpretation": "100% means target fully achieved; above 100% means exceeded target"
    },

    {
      "id": "kpi_gap",
      "category": "KPIs",
      "audience": ["business", "technical"],
      "title": "Product Gap",
      "business_description": "Difference between the threshold value and customer's current product value. Positive gap indicates opportunity to grow.",
      "formula": "gap = threshold_value - current_value",
      "calculation_location": "src/hooks/useCustomerProducts.ts",
      "data_sources": ["customer_products", "product_thresholds"],
      "interpretation": "Positive gap = customer below threshold (opportunity). Negative gap = customer above threshold (achieved)."
    },

    {
      "id": "enum_customer_status",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Customer Status Values",
      "enum_name": "customer_status",
      "values": [
        { "value": "Yeni Musteri", "english": "New Customer", "description": "Recently acquired customer, initial relationship" },
        { "value": "Aktif", "english": "Active", "description": "Customer with regular transactions but limited product penetration" },
        { "value": "Target", "english": "Target", "description": "Customer identified for growth, has cross-sell potential" },
        { "value": "Strong Target", "english": "Strong Target", "description": "High-value customer close to becoming primary bank" },
        { "value": "Ana Banka", "english": "Primary Bank", "description": "Customer where we are the main banking partner" }
      ],
      "progression": "Yeni Musteri -> Aktif -> Target -> Strong Target -> Ana Banka",
      "used_in": ["customers table", "Customer Journey page", "filtering across the app"]
    },

    {
      "id": "enum_action_status",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Action Status Values",
      "enum_name": "action_status",
      "values": [
        { "value": "Beklemede", "english": "Pending", "description": "Action created but not yet planned" },
        { "value": "Planlandy", "english": "Planned", "description": "Action scheduled with a date" },
        { "value": "Tamamlandy", "english": "Completed", "description": "Action successfully completed" },
        { "value": "Ertelendi", "english": "Postponed", "description": "Action postponed to later date" },
        { "value": "Ilgilenmiyor", "english": "Not Interested", "description": "Customer not interested in the offer" },
        { "value": "Uygun Degil", "english": "Not Suitable", "description": "Product not suitable for customer" }
      ],
      "flow": "Beklemede -> Planlandy -> (Tamamlandy | Ertelendi | Ilgilenmiyor | Uygun Degil)",
      "used_in": ["actions table", "Actions Agenda", "Customer Detail Actions tab"]
    },

    {
      "id": "enum_action_priority",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Action Priority Values",
      "enum_name": "action_priority",
      "values": [
        { "value": "high", "description": "Urgent, high-value opportunities. Red badge in UI." },
        { "value": "medium", "description": "Standard priority. Yellow/amber badge in UI." },
        { "value": "low", "description": "Lower urgency items. Gray badge in UI." }
      ],
      "used_in": ["actions table", "Action cards", "Action Planning Modal"]
    },

    {
      "id": "enum_action_type",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Action Type Values",
      "enum_name": "action_type",
      "values": [
        { "value": "model_based", "label": "Model", "description": "AI-generated action recommendation" },
        { "value": "rm_action", "label": "RM Action", "description": "Created by relationship manager" },
        { "value": "ad_hoc", "label": "Ad-Hoc", "description": "One-time action, often from file upload" },
        { "value": "recursive", "label": "Recursive", "description": "Recurring/scheduled action" }
      ],
      "used_in": ["actions table", "Action creation", "AI action generation"]
    },

    {
      "id": "enum_customer_segment",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Customer Segment Values",
      "enum_name": "customer_segment",
      "values": [
        { "value": "MIKRO", "english": "Micro", "description": "Micro businesses - smallest segment" },
        { "value": "KI", "english": "Small", "description": "Small businesses" },
        { "value": "OBI", "english": "SME", "description": "Small and Medium Enterprises" },
        { "value": "TICARI", "english": "Commercial", "description": "Commercial/Corporate - largest segment" }
      ],
      "used_in": ["customers table", "product_thresholds (threshold varies by segment)", "filtering"]
    },

    {
      "id": "enum_customer_sector",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Customer Sector Values",
      "enum_name": "customer_sector",
      "values": [
        { "value": "Turizm", "english": "Tourism" },
        { "value": "Ulasim", "english": "Transportation" },
        { "value": "Perakende", "english": "Retail" },
        { "value": "Gayrimenkul", "english": "Real Estate" },
        { "value": "Tarim Hayvancilik", "english": "Agriculture" },
        { "value": "Saglik", "english": "Healthcare" },
        { "value": "Enerji", "english": "Energy" }
      ],
      "used_in": ["customers table", "product_thresholds (threshold varies by sector)", "filtering", "Primary Bank page"]
    },

    {
      "id": "enum_product_category",
      "category": "Enums",
      "audience": ["business", "technical"],
      "title": "Product Category Values",
      "enum_name": "product_category",
      "values": [
        { "value": "Kredi", "english": "Loans", "description": "Cash and non-cash credit products" },
        { "value": "Kaynak", "english": "Deposits", "description": "Deposit and resource products" },
        { "value": "Odeme", "english": "Payments", "description": "Payment services" },
        { "value": "Tahsilat", "english": "Collections", "description": "Collection services" },
        { "value": "Sigorta", "english": "Insurance", "description": "Insurance products" },
        { "value": "Istirak", "english": "Affiliates", "description": "Investment/affiliate products" }
      ],
      "used_in": ["products table", "Product Performance filtering", "product grouping"]
    },

    {
      "id": "ui_action_planning_modal",
      "category": "UI Components",
      "audience": ["business", "technical"],
      "title": "Action Planning Modal",
      "component": "ActionPlanningModal",
      "file": "src/components/actions/ActionPlanningModal.tsx",
      "business_description": "Full action lifecycle management interface. Allows updating action status, setting planned date, recording achieved value, and adding response notes. Supports navigating through multiple actions for the same customer.",
      "features": [
        "Carousel navigation for multiple actions",
        "Customer information header",
        "Product context with threshold/gap",
        "Status selector (Beklemede, Planlandy, Tamamlandy, etc.)",
        "Date picker for planned date",
        "Volume/value input with thousand separators",
        "Response text/notes field",
        "AI hints display (collapsible)",
        "Action history timeline"
      ],
      "data_displayed": [
        "Customer name, segment, sector",
        "Product name and category",
        "Current value vs threshold vs gap",
        "Action name, description, priority",
        "Creation reason and customer hints",
        "Historical updates"
      ],
      "hooks_used": ["useCustomerById", "useProducts", "useCustomerProducts", "useActionsByCustomer", "useActionUpdates", "useCreateActionUpdate"]
    },

    {
      "id": "ui_add_action_modal",
      "category": "UI Components",
      "audience": ["business", "technical"],
      "title": "Add Action Modal",
      "component": "AddActionModal",
      "file": "src/components/actions/AddActionModal.tsx",
      "business_description": "Quick action creation interface. Allows creating new actions for a customer by selecting a product and action template, setting priority, and optionally adding description.",
      "features": [
        "Product selector",
        "Action template selector (filtered by product)",
        "Priority selector",
        "Target date picker",
        "Description field",
        "Target value input"
      ],
      "hooks_used": ["useProducts", "useActionTemplates", "useCreateAction"]
    },

    {
      "id": "ui_insights_panel",
      "category": "UI Components",
      "audience": ["business", "technical"],
      "title": "AI Insights Panel",
      "component": "InsightsPanel",
      "file": "src/components/dashboard/InsightsPanel.tsx",
      "business_description": "Two-column AI-powered insights panel showing Product Performance analysis and Action Quality analysis. Provides actionable recommendations with version history and feedback capabilities.",
      "layout": "2-column grid on large screens",
      "insight_panels": [
        {
          "name": "Product Performance (Ürün Performansı)",
          "description": "AI-generated analysis of portfolio product metrics",
          "insight_types": ["critical (red/destructive)", "warning (amber)", "info (blue)"],
          "data_source": "ai_insights table, portfolio_targets table",
          "click_behavior": "Opens modal with affected products, analysis, and recommendations",
          "product_links": "Clicking product name navigates to filtered customer list"
        },
        {
          "name": "Action Quality (Aksiyon Kalitesi)",
          "description": "AI analysis of action portfolio quality across four categories",
          "categories": {
            "sufficiency (Yeterlilik)": "Are there enough actions planned?",
            "alignment (Uyum)": "Do actions align with product priorities?",
            "balance (Denge)": "Is the action distribution balanced across customers/products?",
            "quality (Kalite)": "Are actions high quality with proper detail?"
          },
          "data_source": "ai_action_insights table, actions table",
          "click_behavior": "Opens modal with metrics and suggestions"
        }
      ],
      "shared_features": {
        "version_dropdown": "View and switch between historical insight versions",
        "feedback_buttons": "Like/dislike buttons with persistence to database",
        "refresh_button": "Regenerate insights with AI (creates new version)",
        "model_badge": "Shows AI model name used for generation",
        "record_date_badge": "Shows which period the insights are for",
        "loading_skeleton": "Animated skeleton while AI is analyzing",
        "glassmorphism": "Cards use backdrop blur and gradient overlays for visual polish"
      },
      "modal_content": {
        "product_insights": ["Analysis text", "Recommendations list", "Related products with status badges and navigation links"],
        "action_insights": ["Category icon and label", "Analysis text", "Metrics display", "Suggestions list"]
      },
      "hooks_used": ["useInsights", "useActionInsights", "usePortfolioTargets"],
      "edge_functions": ["generate-insights", "generate-action-insights"],
      "related_files": ["src/components/dashboard/InsightsPanel.tsx"]
    },

    {
      "id": "ui_daily_plan_panel",
      "category": "UI Components",
      "audience": ["business", "technical"],
      "title": "Daily Plan Panel",
      "component": "DailyPlanPanel",
      "file": "src/components/dashboard/DailyPlanPanel.tsx",
      "business_description": "A 3-column action planning interface showing monthly pending actions, selected day's actions, and a visual calendar. The calendar uses color intensity to represent action completion density, helping portfolio managers visualize their performance patterns.",
      "layout_columns": [
        {
          "name": "Monthly Pending Actions (Bekleyen Aksiyonlar)",
          "description": "Paginated list (4 items per page) of pending/planned actions for the selected month",
          "sorting": "Pending/planned first, then completed; within each group by date",
          "features": ["Pagination with dot indicators", "Priority badges", "Customer name and product name display"]
        },
        {
          "name": "Day's Actions (Günün Aksiyonları)",
          "description": "Actions for the selected day with inline date dropdown selector",
          "features": ["Week date selector dropdown", "Completed actions shown with strikethrough and success styling", "Priority badges"]
        },
        {
          "name": "Action Calendar (Aksiyon Takvimi)",
          "description": "Mini calendar with visual density indicators for performance tracking"
        }
      ],
      "calendar_visualization": {
        "completed_color": "Blue gradient intensity (hsl 215 60% - lighter to darker based on count)",
        "pending_color": "Amber background (hsl 35 90% 85%) for days with only pending actions",
        "planned_badge": "Circular badge on top-right corner showing planned action count",
        "badge_colors": "Warning color for days with completed actions, Primary color for pending-only days",
        "intensity_formula": "lightness = 70 - (completedIntensity * 48), where completedIntensity = completedCount / maxCompletedActions",
        "hover_behavior": "Shows overlay with completed/total ratio (e.g., 3/5)",
        "today_highlight": "Ring around current day",
        "weekend_styling": "Muted background for Saturday/Sunday",
        "legend": "Shows Completed (blue), Pending (amber), Planned (badge) indicators"
      },
      "monthly_stats": {
        "completed_this_month": "Count of completed actions in selected month",
        "active_days": "Days with at least one action"
      },
      "data_sync": "Syncs with dashboard's global date selector via recordDate prop to show correct month",
      "hooks_used": ["useActions", "useLanguage"],
      "related_files": ["src/components/dashboard/DailyPlanPanel.tsx"]
    },

    {
      "id": "feature_plan_my_day",
      "category": "Features",
      "audience": ["business", "technical"],
      "title": "Plan My Day Feature",
      "business_description": "AI-powered daily planning assistant that analyzes the customer portfolio and recommends which customers to contact and what actions to take. Prioritizes customers based on relationship status, principality score, and product gaps.",
      "how_to_use": [
        "Click 'Plan My Day' button on Dashboard or AI Assistant page",
        "AI analyzes your customer portfolio",
        "Receives prioritized list of customers with recommended actions",
        "Can save recommended actions directly from the response",
        "Supports specific date targeting (e.g., 'plan my day for 2026-01-20')"
      ],
      "prioritization_factors": [
        "Customer status (Strong Target and Target prioritized)",
        "Principality score (lower scores = more opportunity)",
        "Products below threshold (more gaps = more opportunity)",
        "Recent activity date"
      ],
      "technical_implementation": {
        "trigger": "Message containing 'plan my day' or 'gunumu planla'",
        "edge_function": "ai-action-assistant",
        "url_trigger": "/ai-assistant?prompt=plan-my-day&date=YYYY-MM-DD"
      },
      "related_files": ["src/pages/AIAssistant.tsx", "supabase/functions/ai-action-assistant/index.ts", "src/components/ai/PlanMyDayDisplay.tsx"]
    },

    {
      "id": "feature_autopilot",
      "category": "Features",
      "audience": ["business", "technical"],
      "title": "Autopilot Workflows",
      "business_description": "Pre-configured workflow templates for common banking processes. Each workflow has defined steps, some automatic (system-executed) and some requiring human intervention. Helps standardize customer engagement processes.",
      "available_workflows": [
        "Installment Loan Workflow",
        "Credit Card Workflow",
        "Term Deposit Workflow",
        "Trade Finance Workflow"
      ],
      "workflow_structure": {
        "steps": "Ordered list of steps to complete",
        "step_types": ["automatic (system)", "human (requires RM action)"],
        "tracking": "Progress indicator showing completed vs pending steps"
      },
      "component": "AutoPilotPanel",
      "file": "src/components/customer/AutoPilotPanel.tsx"
    },

    {
      "id": "auth_and_rls",
      "category": "Security",
      "audience": ["technical"],
      "title": "Authentication and Row Level Security",
      "authentication": {
        "provider": "Supabase Auth",
        "flow": "Email/password authentication with auto-confirm enabled",
        "session_management": "JWT tokens with automatic refresh via useSessionValidator hook"
      },
      "row_level_security": {
        "principle": "Users can only access data belonging to their portfolio",
        "implementation": "RLS policies on all tables check portfolio_manager_id matches the authenticated user's portfolio manager record",
        "admin_bypass": "Admin role can access additional functionality like threshold editing"
      },
      "protected_routes": {
        "component": "ProtectedRoute",
        "behavior": "Redirects unauthenticated users to /auth"
      },
      "roles": {
        "user": "Standard portfolio manager access",
        "admin": "Threshold editing, SQL queries, system configuration"
      },
      "related_files": ["src/components/ProtectedRoute.tsx", "src/contexts/AuthContext.tsx", "src/hooks/useSessionValidator.ts", "src/hooks/useUserRole.ts"]
    },

    {
      "id": "i18n_languages",
      "category": "Internationalization",
      "audience": ["business", "technical"],
      "title": "Multi-language Support",
      "supported_languages": [
        { "code": "tr", "name": "Turkish", "native": "Turkce" },
        { "code": "en", "name": "English", "native": "English" },
        { "code": "es", "name": "Spanish", "native": "Espanol" }
      ],
      "implementation": {
        "context": "LanguageContext provides t() function for translations",
        "file": "src/i18n/translations.ts contains all translation strings",
        "component": "LanguageSelector allows users to switch languages",
        "persistence": "Selected language saved to user_settings table"
      },
      "translation_namespaces": ["common", "nav", "dashboard", "customers", "actions", "primaryBank", "settings", "thresholds", "ai", "statusLabels", "customerStatusLabels", "sectorLabels", "segmentLabels", "categoryLabels"],
      "related_files": ["src/i18n/translations.ts", "src/contexts/LanguageContext.tsx", "src/components/LanguageSelector.tsx"]
    }
  ]
}
